async function loadDetail() {
        const params = new URLSearchParams(window.location.search);
        const slug = params.get('slug');
        const container = document.getElementById('post-content');
        
        if (!slug) {
            container.innerHTML = "<h1>錯誤</h1><p>網址遺失 slug 參數。</p>";
            return;
        }

        // 使用相對路徑，並確保 slug 格式正確
        const filePath = `./posts/${slug.trim()}.md`;

        try {
            // 加上 t=... 確保不讀取舊的快取
            const response = await fetch(`https://kirstenyau.github.io/posts/${slug.trim()}.md`);
            
            if (!response.ok) {
                // 如果失敗，嘗試加上斜線開頭的路徑
                const altResponse = await fetch(`posts/${slug.trim()}.md`);
                if (!altResponse.ok) {
                    throw new Error(`找不到檔案：${filePath}`);
                }
                return render(await altResponse.text());
            }
            
            render(await response.text());

        } catch (err) {
            console.error("Fetch error:", err);
            container.innerHTML = `
                <div style="background: #fff5f5; padding: 20px; border-radius: 10px; border: 1px solid #feb2b2;">
                    <h1 style="color: #c53030;">文章載入失敗</h1>
                    <p>我們在嘗試讀取 <b>${filePath}</b> 時遇到了問題。</p>
                    <p>請檢查 GitHub 倉庫中的 <b>posts/</b> 資料夾，確認是否存在 <b>${slug}.md</b>。</p>
                    <a href="blog.html" style="color: #3182ce;">← 返回列表重試</a>
                </div>
            `;
        }

        function render(mdText) {
            // 移除 Notion 同步過來的 Front Matter
            const cleanContent = mdText.replace(/^---[\s\S]*?---/, '');
            // 使用 marked 渲染內容
            container.innerHTML = marked.parse(cleanContent);
            // 更新瀏覽器標題
            document.title = slug.split('-').join(' ').toUpperCase();
        }
    }
    loadDetail();
