// 1. å¾ç¶²å€å–å¾— slug (ä¾‹å¦‚: ?slug=career-change-uxui)
const urlParams = new URLSearchParams(window.location.search);
const currentSlug = urlParams.get('slug');

if (currentSlug) {
    // 2. è®€å– posts.json ç²å–æ¨™é¡Œèˆ‡æ—¥æœŸ
    fetch('posts/posts.json')
        .then(response => response.json())
        .then(posts => {
            // ğŸ’¡ é—œéµï¼šåœ¨æ¸…å–®ä¸­å°‹æ‰¾èˆ‡ç¶²å€ slug åŒ¹é…çš„é‚£ä¸€ç¯‡æ–‡ç« 
            const postData = posts.find(p => p.slug === currentSlug);

            if (postData) {
                // æ›´æ–°é é¢ä¸Šçš„æ¨™é¡Œèˆ‡æ—¥æœŸ
                document.getElementById('post-title').innerText = postData.title;
                document.getElementById('post-date').innerText = postData.date;
                // è¨­å®šç€è¦½å™¨åˆ†é æ¨™é¡Œ
                document.title = `${postData.title} | Kirsten's Blog`;
            }
        })
        .catch(err => console.error("è®€å– JSON å¤±æ•—:", err));

    // 3. è®€å–å°æ‡‰çš„ .md æª”æ¡ˆå…§å®¹
    fetch(`posts/${currentSlug}.md`)
        .then(response => {
            if (!response.ok) throw new Error("æ‰¾ä¸åˆ°æ–‡ç« æª”æ¡ˆ");
            return response.text();
        })
        .then(mdText => {
            // ç§»é™¤ Markdown ä¸­çš„ Front Matter (--- ä¹‹é–“çš„å…§å®¹)
            const cleanMd = mdText.replace(/^---[\s\S]+?---/, '');
            // è½‰æ›ç‚º HTML ä¸¦æ¸²æŸ“åˆ°é é¢
            document.getElementById('post-content').innerHTML = marked.parse(cleanMd);
        })
        .catch(err => {
            document.getElementById('post-content').innerHTML = "<p>æŠ±æ­‰ï¼Œæ‰¾ä¸åˆ°è©²æ–‡ç« å…§å®¹ã€‚</p>";
        });
} else {
    window.location.href = 'index.html'; // å¦‚æœæ²’æœ‰ slugï¼Œé€€å›é¦–é 
}
